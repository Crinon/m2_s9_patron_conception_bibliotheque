<!DOCTYPE html>
<html lang="fr"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Réservations</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</head>

<body>
<div th:replace="fragments/header :: header"></div>
<div class="container">

    <h1>Reservations</h1>

    <!-- FORUMAIRE DE CREATION -->
    <form method="POST" id="reservationCreateForm"></form>
    <!-- FORUMAIRE D'ANNULATION -->
    <form th:each="reservation: ${reservations}" th:method="patch" th:id="'cancelForm' + ${reservation.id}"></form>

    <table class="table">
        <!--    ENTETE TABLEAU    -->
        <thead>
        <tr>
            <th scope="col">ID USAGER réservation</th>
            <th scope="col">ID OEUVRE</th>
            <th scope="col">DATE CANCEL</th>
            <th scope="col">DATE RESA</th>
        </tr>
        </thead>

        <!--    CORPS TABLEAU    -->
        <tbody>
        <!--    GENERATION D'UNE LIGNE PAR RESERVATION TROUVEE    -->
        <tr th:each="reservation: ${reservations}">
            <!--    COLONNE DU NOM DU RESERVANT    -->
            <td th:text="${reservation.usager.nom}"></td>
            <!--    COLONNE DU NOM OEUVRE    -->
            <td th:text="${reservation.oeuvre.titre}"></td>
            <!--    COLONNE DE LA DATE D'ANNULATION    -->
            <td th:text="${reservation.dateAnnulation}"></td>
            <!--    COLONNE DE LA DATE DE RESERVATION    -->
            <td th:text="${reservation.dateReservation}"></td>
            <!--    COLONNE DU BOUTON ANNULER    -->
            <td>
                <button type="submit" th:form="'cancelForm' + ${reservation.id}" class="btn btn-danger" data-bs-toggle="tooltip" data-bs-placement="top" title="Annuler">
                    <i class="bi bi-trash"></i>
                </button>
                <input type="hidden" name="reservationID" th:value="${reservation.id}" th:form="'cancelForm' + ${reservation.id}">
            </td>
        </tr>


        <!--    LIGNE FINALE : LIGNE POUR CREER UNE RESERVATION    -->
        <tr>
            <!--    COLONNE POUR SELECTIONNER UN USAGER PARMI LES EXISTANTS    -->
            <td>
                <select name="usager" form="reservationCreateForm">
                    <option th:each="usager : ${usagers}"
                            th:value="${usager.id}"
                            th:utext="${usager.nom}"/>
                </select>
            </td>
            <!--    COLONNE POUR SELECTIONNER UNE OEUVRE PARMI LES EXISTANTES    -->
            <td>
                <select name="oeuvre" form="reservationCreateForm">
                    <option th:each="oeuvre : ${oeuvres}"
                            th:value="${oeuvre.isbn}"
                            th:utext="${oeuvre.titre}"/>
                </select>
            </td>
            <td></td>
            <td colspan="2" class="text-center">
                <button type="submit" class="btn btn-primary mx-auto" form="reservationCreateForm">Créer</button>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>

</html>